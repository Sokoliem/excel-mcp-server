# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
# Use the official Node.js 20 image as the base
FROM node:20-alpine AS build

# Set the working directory
WORKDIR /app

# Copy package.json and package-lock.json (or pnpm-lock.yaml) to the working directory
COPY package.json pnpm-lock.yaml ./

# Install dependencies and build the project
RUN npm install -g pnpm && pnpm install --frozen-lockfile && npm run build

# Use a smaller Node.js base image for the final stage
FROM node:20-alpine AS release

# Set the working directory
WORKDIR /app

# Copy the build output and necessary files from the build stage
COPY --from=build /app/dist /app/dist
COPY --from=build /app/node_modules /app/node_modules
COPY --from=build /app/package.json /app/package.json

# Set environment variables if necessary
ENV NODE_ENV=production

# Command to run the application
ENTRYPOINT ["node", "dist/index.js"]
